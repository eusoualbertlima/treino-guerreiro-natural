<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>üß™ Laborat√≥rio Pessoal - Albert</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="save-button.css">
    <link rel="stylesheet" href="last-workout.css">
    <link rel="stylesheet" href="workout-builder.css">
    <link rel="stylesheet" href="checkin.css">
    <link rel="stylesheet" href="experiments.css">
    <link rel="stylesheet" href="affirmations.css">
    <link rel="stylesheet" href="conscious-training.css">

    <!-- Firebase SDK (free Spark plan) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- App Scripts (order matters) -->
    <script src="firebase-config.js"></script>
    <script src="sync.js"></script>
    <script src="tracking.js"></script>
    <script src="checkin.js"></script>
    <script src="experiments.js?v=2"></script>
    <script src="affirmations.js"></script>
    <script src="conscious-training.js"></script>
    <script src="natural-hacks.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img id="userPhoto" src="" alt="" class="user-photo" style="display:none">
            <div>
                <h1>üß™ Laborat√≥rio Pessoal</h1>
                <span id="userName" class="user-name"></span>
            </div>
        </div>
        <div class="stats">
            <span id="currentWeight">68kg</span>
            <span class="arrow">‚Üí</span>
            <span class="goal">85kg</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tabs Navigation - Hidden, using bottom nav -->
        <div class="tabs" style="display:none">
            <button class="tab" onclick="showTab('checkin')">üåÖ Check-in</button>
            <button class="tab active" onclick="showTab('treino')">üèãÔ∏è Treino</button>
            <button class="tab" onclick="showTab('experiments')">üß™ Experimentos</button>
            <button class="tab" onclick="showTab('dashboard')">üìà Dashboard</button>
        </div>

        <!-- Check-in Tab (NEW) -->
        <div id="checkin" class="tab-content">
            <div id="checkin-content">
                <!-- Check-in form will be loaded here -->
            </div>
        </div>

        <!-- Treino Tab -->
        <div id="treino" class="tab-content active">
            <div class="workout-builder-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 10px;">
                <h3 style="margin: 0; font-size: 1.1rem;">Treino por Dia</h3><button class="btn btn-primary btn-sm"
                    onclick="openTemplateManager()" style="padding: 8px 15px; font-size: 0.9rem;">‚öôÔ∏è Montar
                    Treinos</button>
            </div>
            <div class="day-selector">
                <button class="day-btn" onclick="selectDay('seg')">SEG</button>
                <button class="day-btn" onclick="selectDay('ter')">TER</button>
                <button class="day-btn" onclick="selectDay('qua')">QUA</button>
                <button class="day-btn" onclick="selectDay('qui')">QUI</button>
                <button class="day-btn" onclick="selectDay('sex')">SEX</button>
                <button class="day-btn" onclick="selectDay('sab')">SAB</button>
                <button class="day-btn" onclick="selectDay('dom')">DOM</button>
            </div>

            <div id="workout-content">
                <!-- Workout will be loaded here -->
            </div>
        </div>

        <!-- Nutri√ß√£o Tab -->
        <div id="nutricao" class="tab-content">
            <div class="nutrition-section">
                <h2>ü•© Alimentos Permitidos</h2>

                <div class="food-category">
                    <h3>ü•ö Prote√≠nas</h3>
                    <div class="food-grid">
                        <div class="food-item">
                            <span class="emoji">ü•©</span>
                            <p>Carne Vermelha Gorda</p>
                            <small>Picanha, Fraldinha</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üçó</span>
                            <p>Frango com Pele</p>
                            <small>Coxa, Sobrecoxa</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üêü</span>
                            <p>Peixes Gordos</p>
                            <small>Salm√£o, Sardinha</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">ü•ö</span>
                            <p>Ovos Inteiros</p>
                            <small>6-8 por dia</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üßÄ</span>
                            <p>Queijos</p>
                            <small>Mussarela, Prato</small>
                        </div>
                    </div>
                </div>

                <div class="food-category">
                    <h3>üçö Carboidratos</h3>
                    <div class="food-grid">
                        <div class="food-item">
                            <span class="emoji">üçö</span>
                            <p>Arroz Branco</p>
                            <small>200-300g/refei√ß√£o</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üç†</span>
                            <p>Batata Doce</p>
                            <small>300-400g</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üçå</span>
                            <p>Bananas</p>
                            <small>3-5 por dia</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üåæ</span>
                            <p>Aveia</p>
                            <small>Natural, n√£o instant√¢nea</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üçØ</span>
                            <p>Mel</p>
                            <small>P√≥s-treino</small>
                        </div>
                    </div>
                </div>

                <div class="food-category">
                    <h3>ü•ë Gorduras Saud√°veis</h3>
                    <div class="food-grid">
                        <div class="food-item">
                            <span class="emoji">ü••</span>
                            <p>√ìleo de Coco</p>
                            <small>2-3 colheres/dia</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">ü´í</span>
                            <p>Azeite Extra Virgem</p>
                            <small>Saladas</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">ü•ú</span>
                            <p>Castanhas</p>
                            <small>1 punhado/dia</small>
                        </div>
                        <div class="food-item">
                            <span class="emoji">üßà</span>
                            <p>Manteiga/Ghee</p>
                            <small>Natural</small>
                        </div>
                    </div>
                </div>

                <h2>‚ö° Hacks Ectomorfo</h2>
                <div class="hacks-list">
                    <div class="hack-card">
                        <h3>ü•§ Shake Natural Bomba</h3>
                        <p class="hack-cal">800 kcal</p>
                        <ul>
                            <li>400ml leite integral</li>
                            <li>2 bananas</li>
                            <li>3 ovos crus (pasteurizados)</li>
                            <li>2 colheres mel</li>
                            <li>1 colher √≥leo de coco</li>
                            <li>Canela a gosto</li>
                        </ul>
                        <p class="hack-tip">üí° Tomar 2x ao dia entre refei√ß√µes</p>
                    </div>

                    <div class="hack-card">
                        <h3>‚òï Caf√© da Manh√£ Bomba</h3>
                        <p class="hack-cal">1.000 kcal</p>
                        <ul>
                            <li>6 ovos mexidos com queijo</li>
                            <li>2-3 colheres √≥leo de coco</li>
                            <li>2 bananas + mel</li>
                            <li>100g queijo</li>
                        </ul>
                        <p class="hack-tip">üí° P√≥s-treino CR√çTICO (30min)</p>
                    </div>

                    <div class="hack-card">
                        <h3>üèãÔ∏è Densidade Cal√≥rica</h3>
                        <p class="hack-cal">+500 kcal sem volume</p>
                        <ul>
                            <li>Azeite extra nas saladas</li>
                            <li>√ìleo de coco em tudo</li>
                            <li>NUNCA jogue gemas fora</li>
                            <li>Carnes gordas > magras</li>
                            <li>Frango COM pele</li>
                        </ul>
                        <p class="hack-tip">üí° 1 colher sopa √≥leo = 120 kcal</p>
                    </div>
                </div>

                <h2>üìÖ Plano Di√°rio 3.500 kcal</h2>
                <div class="meal-plan">
                    <div class="meal">
                        <h4>5h00 - Treino Jejum</h4>
                    </div>
                    <div class="meal">
                        <h4>6h30 - P√≥s-Treino (700 kcal)</h4>
                        <p>6 ovos + queijo + 2 bananas + mel</p>
                    </div>
                    <div class="meal">
                        <h4>9h30 - Refei√ß√£o 2 (700 kcal)</h4>
                        <p>200g frango + 250g arroz + salada</p>
                    </div>
                    <div class="meal">
                        <h4>12h30 - Almo√ßo (800 kcal)</h4>
                        <p>250g carne vermelha + 300g batata + verduras</p>
                    </div>
                    <div class="meal">
                        <h4>15h30 - Shake Natural (800 kcal)</h4>
                        <p>Receita acima (leite + bananas + ovos)</p>
                    </div>
                    <div class="meal">
                        <h4>18h30 - Jantar (600 kcal)</h4>
                        <p>200g salm√£o + 200g arroz + salada</p>
                    </div>
                    <div class="meal">
                        <h4>21h00 - Ceia (500 kcal)</h4>
                        <p>4 ovos cozidos + 100g queijo + castanhas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <div id="dashboard-container">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Progresso Tab -->
        <div id="progresso" class="tab-content">
            <div class="progress-section">
                <h2>üìä Seu Progresso</h2>

                <div class="weight-input">
                    <label>Peso Atual:</label>
                    <input type="number" id="weightInput" value="68" step="0.1"> kg
                    <button onclick="updateWeight()">Atualizar</button>
                </div>

                <div class="goal-tracker">
                    <h3>Meta: 68kg ‚Üí 85kg</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <p id="progressText">0% completo</p>
                </div>

                <div class="milestones">
                    <h3>üéØ Marcos</h3>
                    <div class="milestone">
                        <span>3 meses</span>
                        <span>71-73kg</span>
                    </div>
                    <div class="milestone">
                        <span>6 meses</span>
                        <span>75-77kg</span>
                    </div>
                    <div class="milestone">
                        <span>12 meses</span>
                        <span>80-82kg</span>
                    </div>
                    <div class="milestone highlight">
                        <span>18 meses</span>
                        <span>85-90kg √î¬£¬ø</span>
                    </div>
                </div>

                <div class="strength-goals">
                    <h3>üí™ Metas de For√ßa</h3>
                    <div class="strength-card">
                        <h4>Agachamento</h4>
                        <p class="current">Atual: ___kg</p>
                        <p class="goal">Meta 12m: 145kg (1.75x peso)</p>
                    </div>
                    <div class="strength-card">
                        <h4>Supino</h4>
                        <p class="current">Atual: ___kg</p>
                        <p class="goal">Meta 12m: 95kg (1.2x peso)</p>
                    </div>
                    <div class="strength-card">
                        <h4>Terra</h4>
                        <p class="current">Atual: ___kg</p>
                        <p class="goal">Meta 12m: 165kg (2x peso)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Experiments/Lab Tab -->
        <div id="experiments" class="tab-content">
            <div id="experiments-content">
                <!-- Experiments will be loaded here by JavaScript -->
                <div class="loading-placeholder">
                    <p>üîÑ Carregando experimentos...</p>
                </div>
            </div>
        </div>

        <!-- Afirma√ß√µes Tab -->
        <div id="affirmations-tab" class="tab-content">
            <div id="affirmations-content">
                <!-- Affirmations will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Template Manager Modal -->
    <div id="templateManagerModal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">üèãÔ∏è Meus Treinos</h3>
                <button class="modal-close" id="closeTemplateManager">√ó</button>
            </div>
            <button class="btn btn-primary mb-3" onclick="openCreateTemplate()" style="width: 100%;">
                ‚ûï Criar Novo Treino
            </button>
            <div id="templatesList" class="templates-grid">
                <!-- Templates will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Create/Edit Template Modal -->
    <div id="createTemplateModal" class="modal-overlay hidden">
        <div class="modal modal-xl">
            <div class="modal-header">
                <h3 class="modal-title">üìã Montar Treino</h3>
                <button class="modal-close" id="closeCreateTemplate">√ó</button>
            </div>

            <div class="template-builder">
                <!-- Template Name -->
                <div class="input-group mb-3">
                    <label class="input-label">Nome do Treino</label>
                    <input type="text" class="input" id="templateName" placeholder="Ex: Treino A - Peito e Tr√≠ceps">
                </div>

                <div class="builder-layout">
                    <!-- Left: Exercise Library -->
                    <div class="library-section">
                        <h4 class="section-subtitle">üìö Biblioteca de Exerc√≠cios</h4>
                        <div id="muscleFilters" class="muscle-filters">
                            <!-- Filters will be dynamically generated -->
                        </div>
                        <div id="exerciseLibraryList" class="exercise-library">
                            <!-- Exercises will be dynamically generated -->
                        </div>
                    </div>

                    <!-- Right: Selected Exercises -->
                    <div class="selected-section">
                        <h4 class="section-subtitle">‚úÖ Exerc√≠cios do Treino</h4>
                        <div id="selectedExercisesList" class="selected-exercises">
                            <!-- Selected exercises will be dynamically generated -->
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary btn-lg" id="btnSaveTemplate" style="width: 100%; margin-top: 20px;">
                    üíæ Salvar Treino
                </button>
            </div>
        </div>
    </div>

    <!-- Workout Execution Modal -->
    <div id="workoutExecutionModal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">‚ñ∂Ô∏è <span id="executionTemplateName">Treino</span></h3>
                <button class="modal-close" id="closeWorkoutExecution">√ó</button>
            </div>

            <div id="workoutExecutionContent" class="workout-execution">
                <!-- Exercises will be dynamically generated -->
            </div>

            <button class="btn btn-primary btn-lg" id="btnCompleteWorkout" style="width: 100%; margin-top: 20px;">
                ‚úÖ Completar Treino
            </button>
        </div>
    </div>

    <!-- Bottom Navigation (Redesigned) -->
    <nav class="bottom-nav">
        <button class="nav-btn" onclick="showTab('checkin')">
            <span class="icon">üåÖ</span>
            <span class="label">Check-in</span>
        </button>
        <button class="nav-btn active" onclick="showTab('treino')">
            <span class="icon">üèãÔ∏è</span>
            <span class="label">Treino</span>
        </button>
        <button class="nav-btn" onclick="showTab('experiments')">
            <span class="icon">üß™</span>
            <span class="label">Lab</span>
        </button>
        <button class="nav-btn" onclick="showTab('nutricao')">
            <span class="icon">ü•©</span>
            <span class="label">Nutri√ß√£o</span>
        </button>
        <button class="nav-btn" onclick="showTab('dashboard')">
            <span class="icon">üìà</span>
            <span class="label">Stats</span>
        </button>
    </nav>

    <script src="workout-builder.js"></script>
    <script src="app.js"></script>

    <!-- Initialize Firebase and App -->
    <script>
        // Wait for DOM and Firebase to load
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize Firebase
            if (window.FirebaseAuth) {
                window.FirebaseAuth.init();
            }

            // Pre-initialize experiments system
            if (window.ExperimentsSystem) {
                await ExperimentsSystem.init();
            }
        });

        // Extended showTab function for new tabs
        const originalShowTab = window.showTab;
        window.showTab = function (tabName) {
            // Hide all tab contents first
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show the selected tab
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // Call original function if it exists (for treino tab)
            if (typeof originalShowTab === 'function' && tabName === 'treino') {
                originalShowTab(tabName);
            }

            // Handle new tabs initialization
            if (tabName === 'checkin') {
                if (typeof initCheckinTab === 'function') initCheckinTab();
            } else if (tabName === 'experiments') {
                if (typeof initExperimentsTab === 'function') initExperimentsTab();
            } else if (tabName === 'affirmations-tab') {
                if (typeof initAffirmationsTab === 'function') initAffirmationsTab();
            }

            // Update bottom nav active state
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('onclick')?.includes(tabName)) {
                    btn.classList.add('active');
                }
            });
        };

        // Helper function for success messages
        function showSuccess(message) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'toast-success';
            toast.innerHTML = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #10B981, #059669);
                color: white;
                padding: 12px 24px;
                border-radius: 30px;
                font-size: 0.9rem;
                z-index: 9999;
                animation: slideUp 0.3s ease;
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showError(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-error';
            toast.innerHTML = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #EF4444, #DC2626);
                color: white;
                padding: 12px 24px;
                border-radius: 30px;
                font-size: 0.9rem;
                z-index: 9999;
                animation: slideUp 0.3s ease;
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>

</html>